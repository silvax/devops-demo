---
# tasks file for jumpcloud

- gem: name=jumpcloud version=0.3.0 state=present

- command: "curl --silent --show-error --header 'x-connect-key: 24d7f301eaa33b0dc8d40720ac5811fa75ccdb83' https://kickstart.jumpcloud.com/Kickstart >> /tmp/kickstart.sh creates=/tmp/kickstart.sh"

- file: path=/tmp/kickstart.sh mode=0700

- command: /tmp/kickstart.sh creates=/opt/jc/

- template: src=register.rb.j2 dest=/opt/jc/register.rb mode=0755

- copy: src=delete.rb dest=/opt/jc/delete.rb mode=0755

- copy: src=jumpcloud dest=/etc/init.d/jumpcloud mode=0755

- command: chkconfig jumpcloud on creates=/etc/rc0.d/K50jumpcloud

- service: name=jumpcloud state=started

- copy: src=devops-jumpcloud dest=/etc/init.d/jumpcloud mode=0600

- name: remove the ec2 user
  command: find /etc/ -maxdepth 1 -name 'passwd' -o -name 'group' -o -name 'shadow' | xargs sed -i 's/^ec2-user/devops/g'
