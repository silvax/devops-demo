---

  - name: get mount points
    shell: "mount | grep xvdb | cut -d' ' -f3"
    register: mount_points

  - name: unmount xvdb if mounted
    mount: name={{ item }} src=/dev/xvdb state=unmounted fstype=ext3
    with_items: mount_points.stdout_lines

  - name: check if /dev/md0 has been created
    shell: "mdadm -D /dev/md0"
    ignore_errors: yes
    register: md0_created

  - name: create raid 0 with disks availabe
    shell: "yes|mdadm --create --verbose /dev/md0 --level=stripe --raid-devices={{ pvs_list|length }} {{ pvs_list|join (' ') }}"
    when: md0_created.rc != 0
